<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paybuntu - Admin Control Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="styles/admin.css" />
    <link rel="shortcut icon" href="./assets/images/favicon/android-chrome-512x512.png" type="image/x-icon" />
    <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="admin-body" data-theme="dark">
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <i class="fas fa-university"></i>
                <span>Paybuntu Admin</span>
            </div>
            <nav class="nav">
                <div class="nav-item active" data-target="view-overview">
                    <i class="fas fa-chart-line"></i>
                    <span>Overview</span>
                </div>
                <div class="nav-item" data-target="view-users">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </div>
                <div class="nav-item" data-target="view-transactions">
                    <i class="fas fa-list-ul"></i>
                    <span>Global Logs</span>
                </div>
                <div class="nav-item" data-target="view-ledger">
                    <i class="fas fa-book-open"></i>
                    <span>Bank Ledger</span>
                </div>
                <div class="nav-item" data-target="view-settings">
                    <i class="fas fa-tools"></i>
                    <span>System Tools</span>
                </div>
                <div class="nav-item" data-target="view-support">
                    <i class="fas fa-headset"></i>
                    <span>Support Hub</span>
                </div>
            </nav>
            <div class="sidebar-footer">
                <button id="adminLogoutBtn" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="admin-header">
                <h2>Control Center</h2>
                <div class="user-info">
                    <span id="adminEmail">paybuntu@gmail.com</span>
                    <div class="status-dot"></div>
                </div>
            </header>

            <div class="content-view" id="view-overview">
                <div class="section-header">
                    <h3>Analytics Overview</h3>
                    <div class="filter-group">
                        <button class="filter-btn active" data-range="7d">7D</button>
                        <button class="filter-btn" data-range="1m">1M</button>
                        <button class="filter-btn" data-range="1y">1Y</button>
                        <button class="filter-btn" data-range="5y">5Y</button>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="admin-card s-primary">
                        <h3>Total Users</h3>
                        <div class="val" id="totalUsers">0</div>
                    </div>
                    <div class="admin-card s-success">
                        <h3>Total Balance</h3>
                        <div class="val" id="totalBalance">NGN 0</div>
                    </div>
                    <div class="admin-card s-warning">
                        <h3>Total Volume</h3>
                        <div class="val" id="totalVolume">NGN 0</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="admin-card chart-container">
                        <h3>Transaction Volume Trends</h3>
                        <canvas id="txVolumeChart"></canvas>
                    </div>
                    <div class="admin-card chart-container">
                        <h3>User Balance Distribution</h3>
                        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                            <canvas id="balanceDistChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="admin-card chart-container">
                        <h3>App Usage (Logins)</h3>
                        <canvas id="usageChart"></canvas>
                    </div>
                    <div class="admin-card chart-container">
                        <h3>Transaction Types</h3>
                        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                            <canvas id="typeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-view hidden" id="view-users">
                <div class="section-header">
                    <h3>Registered Users</h3>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="userSearch" placeholder="Search by name, email, or account...">
                    </div>
                </div>
                <div class="admin-card">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Account No</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Populated via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="content-view hidden" id="view-transactions">
                <div class="section-header">
                    <h3>Global Transaction Log</h3>
                </div>
                <div class="admin-card">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Sender</th>
                                <th>Amount</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="globalTxTableBody">
                            <!-- Populated via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="content-view hidden" id="view-ledger">
                <div class="section-header">
                    <h3>Bank Ledger & Liquidity</h3>
                </div>

                <div class="stats-grid">
                    <div class="admin-card">
                        <h3>Total Inflow (Deposits)</h3>
                        <div class="val" id="ledgerInflow" style="color: var(--primary);">NGN 0</div>
                    </div>
                    <div class="admin-card">
                        <h3>Total Outflow (Withdrawals)</h3>
                        <div class="val" id="ledgerOutflow" style="color: #ea4335;">NGN 0</div>
                    </div>
                    <div class="admin-card">
                        <h3>Platform Revenue (Fees)</h3>
                        <div class="val" id="ledgerRevenue" style="color: var(--warning);">NGN 0</div>
                    </div>
                    <div class="admin-card">
                        <h3>System Liquidity</h3>
                        <div class="val" id="ledgerLiquidity">NGN 0</div>
                    </div>
                </div>

                <div class="admin-card">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>TX ID</th>
                                <th>User</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Fee</th>
                                <th>System Impact</th>
                            </tr>
                        </thead>
                        <tbody id="ledgerTableBody">
                            <!-- Populated via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="content-view hidden" id="view-support">
                <div class="section-header">
                    <h3>Support Management Hub</h3>
                </div>

                <div class="support-layout">
                    <!-- Chat List Sidebar -->
                    <div class="chat-list-panel admin-card">
                        <div class="panel-header">Active Conversations</div>
                        <div id="activeChatList" class="chat-list-container">
                            <div style="padding: 20px; text-align: center; color: var(--text-muted); font-size: 14px;">
                                <i class="fas fa-spinner fa-spin"></i> Loading chats...
                            </div>
                        </div>
                    </div>

                    <!-- Chat Window -->
                    <div class="chat-window-panel admin-card">
                        <div id="selectedChatHeader" class="chat-window-header">
                            Select a conversation to start chatting
                        </div>
                        <div id="adminChatMessages" class="chat-body admin-chat-body">
                            <!-- Selected chat messages -->
                        </div>
                        <div class="chat-footer">
                            <form id="adminChatForm">
                                <input type="text" id="adminChatInput" placeholder="Type a reply..." disabled
                                    autocomplete="off">
                                <button type="submit" id="adminChatSendBtn" class="btn btn-primary" disabled><i
                                        class="fas fa-paper-plane"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="content-view hidden" id="view-settings">
                <div class="section-header">
                    <h3>System Configuration & Tools</h3>
                    <button id="saveConfigBtn" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>

                <div class="stats-grid">
                    <!-- Maintenance Mode -->
                    <div class="admin-card">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0;">Maintenance Mode</h3>
                            <label class="switch">
                                <input type="checkbox" id="maintenanceToggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-muted);">
                            When active, regular users will see a maintenance page and won't be able to access their
                            dashboard.
                        </p>
                    </div>

                    <!-- Fee Management -->
                    <div class="admin-card">
                        <h3>Transaction Fees</h3>
                        <div style="margin-top: 20px;">
                            <div style="margin-bottom: 15px;">
                                <label
                                    style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px;">Transfer
                                    Fee (%)</label>
                                <input type="number" id="transferFeePercent" class="admin-input" step="0.1" value="0">
                            </div>
                            <div>
                                <label
                                    style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px;">Minimum
                                    Fee (NGN)</label>
                                <input type="number" id="minTransferFee" class="admin-input" step="10" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Broadcast Message -->
                    <div class="admin-card">
                        <h3>Global Broadcast</h3>
                        <div style="margin-top: 20px;">
                            <label
                                style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px;">Banner
                                Message</label>
                            <textarea id="broadcastMessage" class="admin-input" style="height: 80px; resize: none;"
                                placeholder="Enter system-wide announcement..."></textarea>
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 8px;">
                                Leave empty to disable the announcement banner.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="admin-card" style="padding: 0; overflow-x: auto;">
                    <div
                        style="padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin-bottom: 0;">System Audit Logs</h3>
                        <span
                            style="font-size: 11px; color: var(--success); text-transform: uppercase; font-weight: 700; letter-spacing: 1px;">
                            <i class="fas fa-circle" style="font-size: 8px; margin-right: 5px;"></i> Live Feed
                        </span>
                    </div>
                    <div id="auditLogsContainer">
                        <div style="padding: 40px; text-align: center; color: var(--text-muted); font-style: italic;">
                            Initialising audit feed...
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="userActionModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Manage User</h3>
            <div id="userModalDetails"></div>
            <div class="admin-actions">
                <button class="btn btn-warning" id="blockUserBtn">Block Account</button>
                <button class="btn btn-primary" id="adjustBalanceBtn">Adjust Balance</button>
                <button class="btn btn-outline" onclick="closeUserModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="scripts/modalservice.js"></script>
    <script src="scripts/admin.js"></script>
</body>

</html>